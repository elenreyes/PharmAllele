<!DOCTYPE html>
<html>
<head>
    <title>Resultados de bÃºsqueda combinada</title>
    
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- DataTables -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.1/css/jquery.dataTables.min.css">
    <script src="https://cdn.datatables.net/1.13.1/js/jquery.dataTables.min.js"></script>
    <!-- Plotly -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <link href="static/style_results.css" rel="stylesheet" />
</head>

<body>

    <header>
        <h1>{{ title if title else 'Results found' }}</h1>
    </header>

    <div class="container">
    
    <!-- Formulario de bÃºsqueda -->
    <form class="search-panel">
        <label>Drug: <input type="text" name="drug" value="{{ drug if drug else '' }}"></label>
        <label>Variant: <input type="text" name="variant" value="{{ variant if variant else '' }}"></label>
        <button type="submit">Search</button>
    </form>
    
    <p>Searching drugs as: <span class="highlight">{{ drug if drug else 'Cualquiera' }}</span> 
       and variants as: <span class="highlight">{{ variant if variant else 'Cualquiera' }}</span></p>

    <!-- Tabla con id para DataTables -->
    <table id="table-output" class="display">
        <thead>
            <tr>
                <th>Drug</th>
                <th>Variant</th>
                <th>Phenotype category</th>
                <th>Illness</th>
                <th>Evidence</th>
            </tr>
        </thead>
        <tbody>
            {% for res in results %}
            <tr>
                <td>{{ res.drugs_drug_name }}</td>

                <td>
                    <span class="variant">
                        {{ res.variants_variant_name }}
                    </span>
                </td>

                <td>{{ res.phenotype_category_phenotype_category }}</td>

                <td>{{ res.illness_illness_name }}</td>

                <!-- Evidence CON URL Y NIVEL -->
                <td>
                    {% if res.URL_web %}
                        <a href="{{ res.URL_web }}" target="_blank" rel="noopener noreferrer" class="badge">
                            {{ res.evidence_category_evidence_category }}
                            {% if res.evidence_level_evidence_level %}
                                ({{ res.evidence_level_evidence_level }})
                            {% endif %}
                            ðŸ”—
                        </a>
                    {% else %}
                        <span class="badge">
                            {{ res.evidence_category_evidence_category }}
                            {% if res.evidence_level_evidence_level %}
                                ({{ res.evidence_level_evidence_level }})
                            {% endif %}
                        </span>
                    {% endif %}
                </td>

            </tr>
            {% endfor %}
        </tbody>
    </table>

    {% if not results %}
        <p>No se han encontrado asociaciones para esa combinaciÃ³n.</p>
    {% endif %}

    <!-- GrÃ¡fico -->
    <div id="myDiv" style="width:100%; height:400px; margin-top: 30px;"></div>
    </div>
<script>
        $(document).ready(function () {
            var table = $('#table-output').DataTable({
                pageLength: 10,
                language: {
                    search: "Search:",
                    lengthMenu: "Show _MENU_ rows",
                    info: "Showing from _START_ to _END_ of _TOTAL_ results",
                    paginate: {
                        previous: "Previous",
                        next: "Next"
                    }
                }
            });

            // filtro en vivo externo
            $('#liveSearch').on('keyup', function () {
                table.search(this.value).draw();
            });
        });
    </script>

</body>
</html>
